---
title: "a3_task3_shayan_kaveh"
author: "Shayan Kaveh"
date: "10/23/2021"
output: html_document
---

## Overview

This code explores data on red and purple sea urchins recorded by Santa Barbara Coastal Long Term Ecological Research program divers.

**Data:** Reed, D. 2020. SBC LTER: Reef: Long-term experiment: Kelp removal: Urchin size frequency distribution ver 20. Environmental Data Initiative. <https://doi.org/10.6073/pasta/5a1e9ef03aa47bd2225c0bb98a02a63b>.

## Set Up

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(kableExtra)
```

## Read in data

```{r}
urchins <- read_csv(here("data", "urchins.csv")) %>% 
  clean_names()
```

## Section 1

1.  Data visualization: compare the distribution of sizes of purple and red urchins with a histogram

```{r}
ggplot(data = urchins, 
         aes(x = size)) + 
  geom_histogram(bins = 12, 
                 aes(fill = common_name)) +
  theme_minimal() +
  scale_fill_manual(values = c("mediumpurple1", "indianred1")) + #scale_fill_manual() allows me to assign specific colors to each facet based on the vector
  facet_wrap(~ common_name) +
  labs(title = "Distribution of Purple and Red Urchin Sizes",
       key = "Common Name",
       x = "Size (cm)",
       y = "Count",
       caption = "Fig 1. Distribution of urchin sizes based on color from Santa Barbara Coastal Long Term Ecological Research",
       fill = "Common Name") + # "fill" edits the caption name
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        plot.caption = element_text(hjust = 0.05))
```

2.  Descriptive Statistics Table: Create a finalized summary table that contains the following statistics for purple and red urchins (still ignoring site as a variable, but including species as a grouping variable): mean, median, standard deviation, and sample size. Use kableExtra (or another package for tables in R) to finalize your table for your knitted document. Add a table caption above your table

```{r}
urchin_summary <- urchins %>% 
  group_by(common_name) %>% 
  summarize(mean_size = mean(size, na.rm = TRUE),
            median_size = median(size, na.rm = TRUE),
            sd_size = sd(size, na.rm = TRUE),
            sample_size = n())

# Create a table to present the data using kableExtra()
urchin_summary %>% 
  kable(digits = c(2, 2, 2, 2),
        col.names = c("Common Name",
                      "Mean Size (cm)",
                      "Median Size (cm)",
                      "Standard Deviation (cm)",
                      "Sample Size"),
        caption = "<center>Table 1. Summary of Statistics of Purple and Red Urchins<center>") %>% 
  kable_styling(full_width = FALSE) 
```
With far over 30 samples, the data does adhere to the central limit theorem; although the purple urchin distribution is slightly right-skewed. As can be seen by the smaller standard deviation and difference in mean and median, the purple urchin data has more concentrated count with less spread. It is observed that red urchin on average are larger than purple by 2.3 cm or about 33%. 

## Section 2
Explore purple urchin counts by site & year

```{r}
# Create a subset for purple urchins, create a column to show the site year, and write out the full names of the sites

purple_urchins <- urchins %>% 
  filter(common_name == "Purple Urchin") %>% # filter to only include purple urchins
  mutate(mdy = mdy(date)) %>% # create a date class column
  mutate(year = year(mdy)) %>% # create a column with just the year
  mutate(site_full = case_when(
    site == "NAPL" ~ "Naples Reef",
    site == "AQUE" ~ "Arroyo Quemado Reef",
    site == "CARP" ~ "Carpinteria Reef",
    site == "MOHK" ~ "Mohawk Reef",
    site == "IVEE" ~ "Isla Vista Reef"
  )) 

# create a table to see the count of purple urchins in each site per year
purple_count <- purple_urchins %>% 
  group_by(site_full, year) %>% 
  summarize(count = n())
```

Now let's make a graph to visualize the urchin count at each site over the years
```{r}
ggplot(data = purple_count,
       aes(x = year, y = count)) +
  geom_col(aes(fill = site_full)) +
  facet_wrap(~ site_full) +
  theme_minimal() +
  labs(fill = "Site",
       x = "Year",
       y = "Count",
       title = "Purple Urchin Counts from 2008 - 2020",
       caption = "Fig 2. Purple urchin counts at each observation site froom 2008 to 2020 based on Santa Barbara \n Coastal Long Term Ecological Research") +
   theme(plot.title = element_text(hjust = 0.5, size = 15), 
        plot.caption = element_text(hjust = 0.0999),
        legend.title = element_text(size = 7, hjust = 0.5), 
        legend.text = element_text(size = 7),
        legend.key.height = unit(0.4, 'cm'),
        legend.key.width = unit(0.4, 'cm'))
```

Considering these sample populations were recorded at long-term kelp removal experiment sites, this data may not accurately represent the overall purple urchin population. Although there is a trend that populations were largest at the start of the data collection, we need to know how the habitat changed and whether these sample population habitats accurately represent the overall Santa Barbara coast. The large drop in counts during 2020 could also be a result of changes to sample collection due to the COVID-19 pandemic. What can be inferred from this data, however, is that the kelp removal experiment did lead to smaller purple urchin populations. 
